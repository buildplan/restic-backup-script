# =================================================================
#            Configuration for Restic Backup Script
# =================================================================
# !! IMPORTANT !! Set file permissions to 600 (chmod 600 restic-backup.conf)

# --- Repository Settings ---
# Format: sftp:hostname_from_.ssh_config/path/to/backup
RESTIC_REPOSITORY="sftp:storagebox:/home/vps"

# Password file for repository encryption (create with: echo 'your-password' > /root/.restic-password)
RESTIC_PASSWORD_FILE="/root/.restic-password"

# Optional cache directory to prevent ~/.cache/restic growth
RESTIC_CACHE_DIR="/var/cache/restic-backup"

# --- Source Directories ---
# Use Bash array syntax for paths, especially if they contain spaces.
# Each full path should be a separate, quoted element inside the parentheses.
BACKUP_SOURCES=("/home/user_files" "/home/user/my docs")

# --- Backup Options ---
# Backup tag to identify snapshots
BACKUP_TAG="daily-$(hostname)"

# Compression level: auto, off, max
COMPRESSION="max"

# Pack size for optimization (default: empty for auto)
PACK_SIZE="64"

# Enable one-file-system (don't cross filesystem boundaries)
ONE_FILE_SYSTEM=true

# --- Retention Policy ---
# How many snapshots to keep
KEEP_LAST="10"
KEEP_DAILY="7"
KEEP_WEEKLY="4" 
KEEP_MONTHLY="12"
KEEP_YEARLY="3"

# --- Performance ---
# Use nice and ionice for lower priority
LOW_PRIORITY=true

# Nice level (0-19, higher = lower priority)
NICE_LEVEL="19"

# IOnice class (1=real-time, 2=best-effort, 3=idle)
IONICE_CLASS="3"

# Limit the upload speed in KiB/s (e.g., 5000 for ~5MB/s). Leave blank to disable.
LIMIT_UPLOAD=""

# Limit the number of CPU cores Restic can use (e.g., 2). Leave blank for default (all cores).
GOMAXPROCS_LIMIT=""

# Limit the number of concurrent SFTP connections (e.g., 5). Leave blank for default.
SFTP_CONNECTIONS=""

# Limit how many files are read at the same time during a backup (e.g., 2).
# This is the --read-concurrency flag. Leave blank for default.
READ_CONCURRENCY=""

# --- Logging ---
LOG_FILE="/var/log/restic-backup.log"
LOG_LEVEL="1" # 0=quiet, 1=normal, 2=verbose, 3=very verbose

# Max log size in MB before rotation
MAX_LOG_SIZE_MB="10"

# Days to keep rotated logs
LOG_RETENTION_DAYS="30"

# --- Notifications ---
# Enable notifications
NTFY_ENABLED=true
DISCORD_ENABLED=false
SLACK_ENABLED=false
TEAMS_ENABLED=false

# ntfy settings
NTFY_TOKEN="xxxxxxxxxxxxxxxxxxx"
NTFY_URL="https://ntfy.mydomain.tld/topic"

# ntfy priorities (1=min, 3=default, 5=max)
NTFY_PRIORITY_SUCCESS=3
NTFY_PRIORITY_WARNING=4
NTFY_PRIORITY_FAILURE=4

# Discord webhook (if enabled)
DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/your/webhook_url_here"

# Slack webhook (if enabled)
SLACK_WEBHOOK_URL="https://hooks.slack.com/services/your/webhook_url_here"

# Microsoft Teams webhook (if enabled)
TEAMS_WEBHOOK_URL="https://your-tenant.webhook.office.com/webhookb2/your/webhook_url_here"

# --- Healthchecks.io ---
# URL for the "dead man's switch" service to ping on successful completion.
# Leave blank to disable.
# HEALTHCHECKS_URL="https://hc-ping.com/your-unique-uuid-here"

# --- Maintenance ---
# Run integrity check after backup
CHECK_AFTER_BACKUP=false

# Prune repository after forget (removes unreferenced data)
PRUNE_AFTER_FORGET=true

# Automatically fix insecure permissions on config/password files (600/400).
# Enable only for interactive maintenance runs, not in cron/systemd:
# AUTO_FIX_PERMS=false

# --- Exclusions ---
# File containing exclude patterns (one per line)
EXCLUDE_FILE="/etc/restic-excludes.txt"

# Additional exclude patterns (space-separated)
EXCLUDE_PATTERNS="*.tmp *.log *.cache .DS_Store Thumbs.db"
